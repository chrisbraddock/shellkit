{{ if eq .profile "full" -}}
#!/usr/bin/env bash
set -euo pipefail

echo "==> Bootstrap: ensuring Homebrew is available..."

{{ if eq .chezmoi.os "darwin" -}}
if ! command -v brew &>/dev/null; then
    echo "Installing Homebrew..."
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
fi
# Support both Apple Silicon (/opt/homebrew) and Intel Mac (/usr/local)
if [[ -f "/opt/homebrew/bin/brew" ]]; then
    eval "$(/opt/homebrew/bin/brew shellenv)"
elif [[ -f "/usr/local/bin/brew" ]]; then
    eval "$(/usr/local/bin/brew shellenv)"
fi
{{ else -}}
if ! command -v brew &>/dev/null; then
    echo "Installing Homebrew for Linux..."
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
fi
eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)" 2>/dev/null || true
{{ end -}}

echo "==> Bootstrap complete"
{{ end -}}
