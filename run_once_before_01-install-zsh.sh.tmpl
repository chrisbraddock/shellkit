#!/usr/bin/env bash
# Bootstrap: ensure zsh is installed (required for all profiles)
set -euo pipefail

if command -v zsh &>/dev/null; then
    echo "==> zsh already installed"
    exit 0
fi

echo "==> Installing zsh (required)..."

{{ if eq .chezmoi.os "darwin" -}}
# macOS: use Homebrew
if command -v brew &>/dev/null; then
    brew install zsh
else
    echo "ERROR: Homebrew required to install zsh on macOS" >&2
    exit 1
fi
{{ else if eq .chezmoi.os "linux" -}}
# Linux: use apt or yum
if command -v apt-get &>/dev/null; then
    sudo apt-get update && sudo apt-get install -y zsh
elif command -v yum &>/dev/null; then
    sudo yum install -y zsh
elif command -v dnf &>/dev/null; then
    sudo dnf install -y zsh
else
    echo "ERROR: No supported package manager found (apt, yum, dnf)" >&2
    exit 1
fi
{{ end -}}

echo "==> zsh installed successfully"
echo ""
echo "To set zsh as your default shell, run:"
echo "  chsh -s \$(which zsh)"
